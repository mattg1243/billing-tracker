extends layout 

block content 

    h1(name="clientname") #{client['fname'] + ' ' + client['lname']}
    p1 Balance: $ #{parseFloat(client.balance.toString()).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}

    .container(style="min-height: 50vh;")
        table.table.table-hover.align-middle#eventTable(height=200 style="table-layout: fixed;")
            thead
                
                if events.length == 0
                    tr(height=200) 
                        th(style="text-align: center;") No events logged for this client 
                else
                    tr(height=50)
                        tbody
                        th(scope="col") Date 
                        th(scope="col") Type 
                        th(scope="col") Time  
                        th(scope="col") Amount

                        
                    tbody
                    each e in events 
                        tr.eventRow(scope="row" height=50, data-href=`event/${e._id}`)
                            td= moment(e.date).format("MM/DD/YYYY")
                            td= e.type
                            if (meetings.includes(e.type) || misc.includes(e.type))
                                td= e.duration 
                            else   
                                td - 
                            td= '$ ' + `${parseFloat(e['amount'].toString()).toFixed(2).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`

        .container.d-inline-flex.justify-content-center.gap-5(style="justify-content: space-around !important;")#eventFloat 
            button.btn.btn-lg.btn-floating.shadow-2-strong#addEvent(style="background-color: #0d6efd; display: flex; justify-content: center;" type='button', data-mdb-toggle="modal" data-mdb-target="#eventModal")
                i.fas.fa-plus.fa-2x(style="color: white;")
            button.btn.btn-lg.btn-floating.shadow-2-strong#makeStatement(style="background-color: #0d6efd; display: flex; justify-content: center;" type='button' data-mdb-toggle="modal" data-mdb-target="#statementModal")
                i.fas.fa-file-invoice-dollar.fa-2x(style="color: white;")

    
    #eventModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='eventModalLabel', aria-hidden='true')
        .modal-dialog(role='document')
            .modal-content
                .modal-header
                    h2#eventModalLabel.modal-title(style="font-size: 2em;") Event Details
                    button.btn-close(type='button', data-mdb-dismiss='modal', aria-label='Close')

                .modal-body.text-center.mb-1
                    form.needs-validation#eventForm(action=`${client._id}/addsession` method="post" name="eventForm")
                        .md-form.mb-5
                            label.form-label Date 
                            input.form-control#datePicker(type="date" step=0.1 name="date" placeholder="Date" required)
                        .md-form.mb-5 
                            label.form-label Event Type 
                            select.form-select#eventTypeSelector(name="type" required) Type
                                option(value='') Select...
                                option(value='1:1 Meeting') 1:1 Meeting   
                                option(value='3 Way Meeting') 3 Way Meeting  
                                option(value='4 Way Meeting') 4 Way Meeting  
                                option(value='5 Way Meeting') 5 Way Meeting  
                                option(value='6 Way Meeting') 6 Way Meeting  
                                option(value='Emails') Emails               
                                option(value='Intention Statement') Intention Statement   
                                option(value='Notes') Notes
                                option(value='Parenting Plan') Parenting Plan 
                                option(value='Phone Call') Phone Call
                                option(value='Refund') Refund
                                option(value='Retainer') Retainer
                                option(value='Team Meeting') Team Meeting
                                option(value='Travel Time') Travel Time                     
                        .md-form.mb-5.d-inline-flex.justify-content-center#timeField(style="display: none;")
                            select.form-select.form-control#hrsField(name="hours" style="display: none;")
                                option(value=0) 0 hr 
                                option(value=1) 1 hr
                                option(value=2) 2 hr
                                option(value=3) 3 hr
                                option(value=4) 4 hr
                                option(value=5) 5 hr
                                option(value=6) 6 hr
                                option(value=7) 7 hr
                                option(value=8) 8 hr
                                option(value=9) 9 hr
                                option(value=10) 10 hr
                                option(value=0) 0 hr
                            select.form-select.form-control#minField(name="minutes" style="display: none;") 
                                option(value=0) 0 mins
                                option(value=0.1) 1-6 mins
                                option(value=0.2) 7-12 mins
                                option(value=0.3) 13-18 mins 
                                option(value=0.4) 19-24 mins
                                option(value=0.5) 25-30 mins
                                option(value=0.6) 31-36 mins
                                option(value=0.7) 37-42 mins
                                option(value=0.8) 43-48 mins
                                option(value=0.9) 49-54 mins
                        .md-form.mb-5#rateField(style="display: none;")
                            label.form-label Rate 
                            input.form-control(type="number" name="rate")
                        .md-form.mb-5#amountField(style="display: none;") 
                            label.form-label Amount 
                            input.form-control(type="text" name="amount" placeholder="$")

                        .modal-footer.d-flex.justify-content-center 
                            input.btn.btn-primary(type="submit" value="Create Event")


    #statementModal.modal.fade(tabindex='-1', role='dialog', aria-labelledby='exampleModalLabel', aria-hidden='true')
        .modal-dialog(role='document')
            .modal-content
                .modal-header
                    h2#exampleModalLabel.modal-title(style="font-size: 2em;") Statement Details
                    button.btn-close(type='button', data-mdb-dismiss='modal', aria-label='Close')

                .modal-body.text-center.mb-1
                    form(action= `${client._id}/makestatement/${client.fname}/${client.lname}` method="post")
                        .md-form.mb-5.d-flex.flex-column.justify-content-center.align-items-center.gap-2
                            label.form-label Start Date
                            input.form-control#datePicker(type="date" step=0.1 name="startdate" placeholder="Date" required)
                            label.form-label End Date
                            input.form-control#datePicker(type="date" step=0.1 name="enddate" placeholder="Date" required)
                        
                        .modal-footer.d-flex.flex-column.justify-content-center 
                            input.btn.btn-primary#downloadBtn(type="submit" value="Download")
                            i.material-icons(style="display: none;") done
